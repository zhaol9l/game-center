<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®¡ç†å‘˜ä¸­å¿ƒ - GAME CENTER</title>
    <style>
        :root {
            --primary-color: #4CAF50;
            --bg-dark: #0f0f1a;
            --card-bg: rgba(30, 30, 46, 0.9);
            --text-main: #e0e0e0;
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background: radial-gradient(circle at center, #1a1a2e 0%, #0f0f1a 100%);
            color: var(--text-main);
            margin: 0;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        /* èƒŒæ™¯è£…é¥° */
        .bg-glow {
            position: absolute;
            width: 500px;
            height: 500px;
            background: radial-gradient(circle, rgba(76, 175, 80, 0.1) 0%, transparent 70%);
            z-index: -1;
            filter: blur(50px);
            animation: pulse 8s infinite alternate;
        }

        @keyframes pulse {
            from { transform: scale(1); opacity: 0.5; }
            to { transform: scale(1.2); opacity: 0.8; }
        }

        .auth-container {
            width: 400px;
            background: var(--card-bg);
            padding: 40px;
            border-radius: 20px;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(76, 175, 80, 0.3);
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            position: relative;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .auth-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .auth-logo {
            font-size: 40px;
            margin-bottom: 10px;
            display: block;
        }

        .auth-title {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary-color);
            letter-spacing: 2px;
        }

        .tab-group {
            display: flex;
            margin-bottom: 30px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .tab {
            flex: 1;
            text-align: center;
            padding: 10px;
            cursor: pointer;
            transition: 0.3s;
            color: #888;
            font-weight: bold;
        }

        .tab.active {
            color: var(--primary-color);
            border-bottom: 2px solid var(--primary-color);
        }

        .form-group {
            margin-bottom: 20px;
            position: relative;
        }

        .form-group label {
            display: block;
            font-size: 13px;
            color: #aaa;
            margin-bottom: 8px;
            margin-left: 5px;
        }

        .form-group input {
            width: 100%;
            padding: 12px 15px;
            background: rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 8px;
            color: #fff;
            box-sizing: border-box;
            transition: 0.3s;
            outline: none;
        }

        .form-group input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 10px rgba(76, 175, 80, 0.2);
            background: rgba(0,0,0,0.5);
        }

        .btn-auth {
            width: 100%;
            padding: 14px;
            background: linear-gradient(45deg, #4CAF50, #45a049);
            border: none;
            border-radius: 8px;
            color: white;
            font-weight: bold;
            font-size: 16px;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-auth:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(76, 175, 80, 0.4);
        }

        .auth-footer {
            margin-top: 25px;
            text-align: center;
            font-size: 13px;
            color: #666;
        }

        .auth-footer a {
            color: var(--primary-color);
            text-decoration: none;
        }

        /* åŠ¨ç”»æ•ˆæœ */
        .fade-in { animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        #loginForm, #registerForm {
            display: none;
        }

        #loginForm.active, #registerForm.active {
            display: block;
        }

        .message {
            position: fixed;
            top: 20px;
            padding: 15px 30px;
            border-radius: 8px;
            background: var(--card-bg);
            border-left: 4px solid var(--primary-color);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            display: none;
            z-index: 1000;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="bg-glow"></div>
    
    <div class="auth-container fade-in">
        <div class="auth-header">
            <span class="auth-logo">ğŸ›¡ï¸</span>
            <div class="auth-title">ADMIN PANEL</div>
        </div>

        <div class="tab-group">
            <div class="tab active" onclick="switchTab('login')">ç™»å½•</div>
            <div class="tab" onclick="switchTab('register')">æ³¨å†Œ</div>
        </div>

        <!-- ç™»å½•è¡¨å• -->
        <form id="loginForm" class="active" onsubmit="handleAuth(event, 'login')">
            <div class="form-group">
                <label>ç®¡ç†å‘˜è´¦å·</label>
                <input type="text" id="loginUser" placeholder="è¯·è¾“å…¥è´¦å·" required>
            </div>
            <div class="form-group">
                <label>è®¿é—®å¯†é’¥</label>
                <input type="password" id="loginPass" placeholder="è¯·è¾“å…¥å¯†ç " required>
            </div>
            <div style="text-align: right; margin-bottom: 20px; margin-top: -10px;">
                <a href="javascript:void(0)" onclick="showFindPwd()" style="color: var(--primary-color); font-size: 13px; text-decoration: none;">å¿˜è®°å¯†ç ï¼Ÿ</a>
            </div>
            <button type="submit" class="btn-auth">è¿›å…¥ç®¡ç†ç³»ç»Ÿ</button>
        </form>

        <!-- æ‰¾å›å¯†ç è¡¨å• (å¼¹çª—å½¢å¼) -->
        <div id="findPwdModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:1000; justify-content:center; align-items:center;">
            <div class="auth-container" style="width:350px; border: 2px solid var(--primary-color);">
                <div class="auth-header">
                    <div class="auth-title" id="findPwdTitle">æ‰¾å›å¯†é’¥</div>
                </div>
                <div class="form-group">
                    <label id="findUserLabel">è´¦å·</label>
                    <input type="text" id="findUser" placeholder="è¯·è¾“å…¥è¦æ‰¾å›çš„è´¦å·">
                </div>
                <div class="form-group">
                    <label id="findCodeLabel">ç³»ç»Ÿæˆæƒç </label>
                    <input type="password" id="findAuthCode" placeholder="è¯·è¾“å…¥æˆæƒç ä»¥éªŒè¯èº«ä»½">
                </div>
                <div class="form-group">
                    <label id="newPassLabel">æ–°å¯†é’¥</label>
                    <input type="password" id="newPass" placeholder="è¯·è¾“å…¥æ–°å¯†ç ">
                </div>
                <button class="btn-auth" onclick="handleFindPwd()" id="btnReset">é‡ç½®å¹¶ä¿å­˜</button>
                <button class="btn-auth" style="background:transparent; border:1px solid #666; margin-top:10px;" onclick="hideFindPwd()" id="btnCancelReset">å–æ¶ˆ</button>
            </div>
        </div>

        <!-- æ³¨å†Œè¡¨å• -->
        <form id="registerForm" onsubmit="handleAuth(event, 'register')">
            <div class="form-group">
                <label>åˆ›å»ºè´¦å·</label>
                <input type="text" id="regUser" placeholder="ç”±å­—æ¯å’Œæ•°å­—ç»„æˆ" required>
            </div>
            <div class="form-group">
                <label>è®¾ç½®å¯†é’¥</label>
                <input type="password" id="regPass" placeholder="è‡³å°‘ 6 ä½å­—ç¬¦" required>
            </div>
            <div class="form-group">
                <label>ç®¡ç†å‘˜æˆæƒç </label>
                <input type="password" id="regCode" placeholder="è¯·è¾“å…¥ç³»ç»Ÿæˆæƒç " required>
            </div>
            <button type="submit" class="btn-auth">åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·</button>
        </form>

        <div class="auth-footer">
            <p>Â© 2025 GAME CENTER | <a href="index.html">è¿”å›é¦–é¡µ</a></p>
        </div>
    </div>

    <div id="message" class="message"></div>

    <script>
        const i18n = {
            zh: {
                title: "ADMIN PANEL",
                login: "ç™»å½•",
                register: "æ³¨å†Œ",
                userLabel: "ç®¡ç†å‘˜è´¦å·",
                passLabel: "è®¿é—®å¯†é’¥",
                regUserLabel: "åˆ›å»ºè´¦å·",
                regPassLabel: "è®¾ç½®å¯†é’¥",
                regCodeLabel: "ç®¡ç†å‘˜æˆæƒç ",
                btnEnter: "è¿›å…¥ç®¡ç†ç³»ç»Ÿ",
                btnCreate: "åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·",
                backHome: "è¿”å›é¦–é¡µ",
                authCodeError: "æ— æ•ˆçš„æˆæƒç ï¼",
                userExist: "è¯¥è´¦å·å·²å­˜åœ¨ï¼",
                regSuccess: "ç®¡ç†å‘˜è´¦å·åˆ›å»ºæˆåŠŸï¼è¯·ç™»å½•",
                loginSuccess: "ç™»å½•æˆåŠŸï¼æ­£åœ¨è¿›å…¥ç®¡ç†åå°...",
                loginError: "è´¦å·æˆ–å¯†ç é”™è¯¯ï¼",
                findPwdTitle: "æ‰¾å›å¯†é’¥",
                findUserLabel: "è´¦å·",
                findCodeLabel: "ç³»ç»Ÿæˆæƒç ",
                newPassLabel: "æ–°å¯†é’¥",
                btnReset: "é‡ç½®å¹¶ä¿å­˜",
                btnCancel: "å–æ¶ˆ",
                resetSuccess: "å¯†ç å·²é‡ç½®ï¼è¯·ä½¿ç”¨æ–°å¯†ç ç™»å½•",
                resetError: "æˆæƒç é”™è¯¯æˆ–è´¦å·ä¸å­˜åœ¨ï¼",
                forgotPwd: "å¿˜è®°å¯†ç ï¼Ÿ"
            },
            en: {
                title: "ADMIN PANEL",
                login: "Login",
                register: "Register",
                userLabel: "Admin Username",
                passLabel: "Access Key",
                regUserLabel: "Create Username",
                regPassLabel: "Set Key",
                regCodeLabel: "Auth Code",
                btnEnter: "Enter Admin System",
                btnCreate: "Create Admin Account",
                backHome: "Back to Home",
                authCodeError: "Invalid Auth Code!",
                userExist: "Account already exists!",
                regSuccess: "Admin account created! Please login",
                loginSuccess: "Success! Entering dashboard...",
                loginError: "Invalid username or password!",
                findPwdTitle: "Reset Key",
                findUserLabel: "Username",
                findCodeLabel: "Auth Code",
                newPassLabel: "New Key",
                btnReset: "Reset & Save",
                btnCancel: "Cancel",
                resetSuccess: "Password reset success! Please login",
                resetError: "Invalid code or user not found!",
                forgotPwd: "Forgot Password?"
            },
            jp: {
                title: "ç®¡ç†è€…ãƒ‘ãƒãƒ«",
                login: "ãƒ­ã‚°ã‚¤ãƒ³",
                register: "æ–°è¦ç™»éŒ²",
                userLabel: "ç®¡ç†è€…ID",
                passLabel: "ã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼",
                regUserLabel: "IDä½œæˆ",
                regPassLabel: "ã‚­ãƒ¼è¨­å®š",
                regCodeLabel: "èªè¨¼ã‚³ãƒ¼ãƒ‰",
                btnEnter: "ã‚·ã‚¹ãƒ†ãƒ ã«å…¥ã‚‹",
                btnCreate: "ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ",
                backHome: "ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹",
                authCodeError: "ç„¡åŠ¹ãªèªè¨¼ã‚³ãƒ¼ãƒ‰ã§ã™ï¼",
                userExist: "ã“ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¯æ—¢ã«å­˜åœ¨ã—ã¾ã™ï¼",
                regSuccess: "ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆã—ã¾ã—ãŸï¼ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„",
                loginSuccess: "ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸï¼ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã¸...",
                loginError: "IDã¾ãŸã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ï¼",
                findPwdTitle: "ã‚­ãƒ¼ãƒªã‚»ãƒƒãƒˆ",
                findUserLabel: "ID",
                findCodeLabel: "èªè¨¼ã‚³ãƒ¼ãƒ‰",
                newPassLabel: "æ–°ã—ã„ã‚­ãƒ¼",
                btnReset: "ãƒªã‚»ãƒƒãƒˆ",
                btnCancel: "ã‚­ãƒ£ãƒ³ã‚»ãƒ«",
                resetSuccess: "ãƒªã‚»ãƒƒãƒˆå®Œäº†ï¼ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„",
                resetError: "èªè¨¼ã‚³ãƒ¼ãƒ‰ãŒé•ã†ã‹ã€IDãŒå­˜åœ¨ã—ã¾ã›ã‚“",
                forgotPwd: "ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å¿˜ã‚ŒãŸå ´åˆ"
            }
        };

        function initAuthPage() {
            const savedSettings = JSON.parse(localStorage.getItem('gameCenterSettings')) || { language: 'zh', darkMode: true };
            const lang = savedSettings.language || 'zh';
            const dict = i18n[lang];

            // åº”ç”¨è¯­è¨€
            document.querySelector('.auth-title').textContent = dict.title;
            document.querySelectorAll('.tab')[0].textContent = dict.login;
            document.querySelectorAll('.tab')[1].textContent = dict.register;
            
            document.querySelectorAll('label')[0].textContent = dict.userLabel;
            document.querySelectorAll('label')[1].textContent = dict.passLabel;
            document.querySelectorAll('label')[2].textContent = dict.regUserLabel;
            document.querySelectorAll('label')[3].textContent = dict.regPassLabel;
            document.querySelectorAll('label')[4].textContent = dict.regCodeLabel;

            document.querySelectorAll('.btn-auth')[0].textContent = dict.btnEnter;
            document.querySelectorAll('.btn-auth')[1].textContent = dict.btnCreate;
            
            // æ‰¾å›å¯†ç è¯­è¨€åº”ç”¨
            document.querySelector('a[onclick="showFindPwd()"]').textContent = dict.forgotPwd;
            document.getElementById('findPwdTitle').textContent = dict.findPwdTitle;
            document.getElementById('findUserLabel').textContent = dict.findUserLabel;
            document.getElementById('findCodeLabel').textContent = dict.findCodeLabel;
            document.getElementById('newPassLabel').textContent = dict.newPassLabel;
            document.getElementById('btnReset').textContent = dict.btnReset;
            document.getElementById('btnCancelReset').textContent = dict.btnCancel;

            const footerText = `Â© 2025 GAME CENTER`;
            document.querySelector('.auth-footer').innerHTML = footerText;

            // åº”ç”¨ä¸»é¢˜
            if (!savedSettings.darkMode) {
                document.body.style.background = 'linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%)';
                document.querySelector('.auth-container').style.background = 'rgba(255, 255, 255, 0.9)';
                document.querySelector('.auth-container').style.borderColor = '#4CAF50';
                document.body.style.color = '#333';
            }
        }

        window.onload = () => {
            initAuthPage();
            if (!localStorage.getItem('gameAdmins')) {
                localStorage.setItem('gameAdmins', JSON.stringify({ 'admin': 'admin123' }));
            }
            // è‡ªåŠ¨å¡«å……ä¸Šæ¬¡ç™»å½•çš„è´¦å·
            const lastUser = localStorage.getItem('lastAdminUser');
            if (lastUser) {
                document.getElementById('loginUser').value = lastUser;
                // å¦‚æœæœ‰è´¦å·ï¼Œç„¦ç‚¹è‡ªåŠ¨è·³è½¬åˆ°å¯†ç æ¡†
                document.getElementById('loginPass').focus();
            }
        };

        function switchTab(type) {
            const tabs = document.querySelectorAll('.tab');
            const forms = [document.getElementById('loginForm'), document.getElementById('registerForm')];
            
            tabs.forEach(t => t.classList.remove('active'));
            forms.forEach(f => f.classList.remove('active'));

            if (type === 'login') {
                tabs[0].classList.add('active');
                forms[0].classList.add('active');
            } else {
                tabs[1].classList.add('active');
                forms[1].classList.add('active');
            }
        }

        function showMessage(text, isError = false) {
            const msg = document.getElementById('message');
            msg.textContent = text;
            msg.style.display = 'block';
            msg.style.borderLeftColor = isError ? '#ff4b2b' : '#4CAF50';
            
            setTimeout(() => {
                msg.style.display = 'none';
            }, 3000);
        }

        function showFindPwd() {
            document.getElementById('findPwdModal').style.display = 'flex';
        }

        function hideFindPwd() {
            document.getElementById('findPwdModal').style.display = 'none';
        }

        function handleFindPwd() {
            const user = document.getElementById('findUser').value.trim();
            const code = document.getElementById('findAuthCode').value.trim();
            const newPass = document.getElementById('newPass').value.trim();
            
            const savedSettings = JSON.parse(localStorage.getItem('gameCenterSettings')) || { language: 'zh' };
            const dict = i18n[savedSettings.language || 'zh'];

            if (!user || !code || !newPass) {
                showMessage("è¯·å¡«å†™æ‰€æœ‰å­—æ®µ", true);
                return;
            }

            if (code !== '666') {
                showMessage(dict.authCodeError, true);
                return;
            }

            const admins = JSON.parse(localStorage.getItem('gameAdmins')) || {};
            if (!admins[user]) {
                showMessage(dict.resetError, true);
                return;
            }

            admins[user] = newPass;
            localStorage.setItem('gameAdmins', JSON.stringify(admins));
            showMessage(dict.resetSuccess);
            hideFindPwd();
        }

        async function handleAuth(event, type) {
            event.preventDefault();
            
            const savedSettings = JSON.parse(localStorage.getItem('gameCenterSettings')) || { language: 'zh' };
            const dict = i18n[savedSettings.language || 'zh'];

            if (type === 'register') {
                const user = document.getElementById('regUser').value.trim();
                const pass = document.getElementById('regPass').value.trim();
                const code = document.getElementById('regCode').value.trim();

                try {
                    const res = await fetch('/api/register', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ username: user, password: pass, authCode: code })
                    });
                    const data = await res.json();
                    if (res.ok) {
                        showMessage(dict.regSuccess);
                        localStorage.setItem('lastAdminUser', user);
                        switchTab('login');
                        document.getElementById('loginUser').value = user;
                        document.getElementById('loginPass').focus();
                    } else {
                        showMessage(data.message || dict.authCodeError, true);
                    }
                } catch (err) {
                    showMessage("è¿æ¥æœåŠ¡å™¨å¤±è´¥", true);
                }
            } else {
                const user = document.getElementById('loginUser').value;
                const pass = document.getElementById('loginPass').value;

                try {
                    const res = await fetch('/api/login', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ username: user, password: pass })
                    });
                    const data = await res.json();
                    if (res.ok) {
                        showMessage(dict.loginSuccess);
                        localStorage.setItem('isAdminLoggedIn', 'true');
                        localStorage.setItem('currentAdmin', data.username);
                        localStorage.setItem('lastAdminUser', data.username);
                        
                        // åŒæ­¥äº‘ç«¯èµ„æ–™åˆ°æœ¬åœ°è®¾ç½®
                        const settings = JSON.parse(localStorage.getItem('gameCenterSettings')) || {};
                        if (data.nickname) settings.userName = data.nickname;
                        if (data.avatar) settings.avatar = data.avatar;
                        localStorage.setItem('gameCenterSettings', JSON.stringify(settings));

                        setTimeout(() => {
                            window.location.href = 'index.html';
                        }, 1500);
                    } else {
                        showMessage(data.message || dict.loginError, true);
                    }
                } catch (err) {
                    showMessage("è¿æ¥æœåŠ¡å™¨å¤±è´¥", true);
                }
            }
        }

        // é¢„è®¾ä¸€ä¸ªæ¼”ç¤ºè´¦å·
        if (!localStorage.getItem('gameAdmins')) {
            localStorage.setItem('gameAdmins', JSON.stringify({ 'admin': 'admin123' }));
        }
    </script>
</body>
</html>