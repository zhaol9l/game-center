<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¸¸æˆè®¾ç½® - GAME CENTER</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* å¤ç”¨ä¸»é¡µå¯¼èˆªæ æ ·å¼ */
        .game-navbar {
            background: rgba(20, 20, 20, 0.95);
            padding: 0 50px;
            height: 70px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 4px 20px rgba(0,0,0,0.4);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            border-bottom: 3px solid #4CAF50;
            backdrop-filter: blur(10px);
        }
        .nav-logo {
            color: #4CAF50;
            font-size: 24px;
            font-weight: 900;
            text-decoration: none;
            letter-spacing: 2px;
        }
        .nav-links {
            display: flex;
            gap: 30px;
            list-style: none;
        }
        .nav-link {
            text-decoration: none;
            color: #ddd;
            font-weight: 600;
            transition: 0.3s;
        }
        .nav-link:hover, .nav-link.active {
            color: #4CAF50;
        }

        /* ç§»åŠ¨ç«¯èœå•æŒ‰é’® */
        .menu-toggle {
            display: none;
            flex-direction: column;
            gap: 5px;
            cursor: pointer;
            padding: 10px;
            z-index: 1001;
        }
        .menu-toggle span {
            display: block;
            width: 25px;
            height: 3px;
            background: #4CAF50;
            border-radius: 3px;
            transition: 0.3s;
        }

        .nav-user {
            display: flex;
            align-items: center;
            gap: 15px;
            color: #fff;
        }
        .user-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            border: 2px solid #4CAF50;
            background: #333;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            box-shadow: 0 0 10px rgba(76, 175, 80, 0.5);
            cursor: pointer;
            transition: 0.3s;
        }
        .user-avatar:hover {
            transform: scale(1.1);
            border-color: #81C784;
        }
        .user-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .exclusive-channel {
            background: linear-gradient(45deg, #ff4081, #7c4dff);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: bold;
            letter-spacing: 1px;
            box-shadow: 0 0 10px rgba(255, 64, 129, 0.5);
            animation: pulseChannel 2s infinite;
        }
        @keyframes pulseChannel {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.8; }
            100% { transform: scale(1); opacity: 1; }
        }

        /* æµ…è‰²æ¨¡å¼é€‚é… */
        body.light-mode {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: #333;
        }
        body.light-mode .game-navbar {
            background: rgba(255, 255, 255, 0.95);
            border-bottom-color: #4CAF50;
        }
        body.light-mode .nav-link { color: #555; }
        body.light-mode .settings-container {
            background: rgba(255, 255, 255, 0.8);
            border-color: rgba(0,0,0,0.1);
            color: #333;
        }
        body.light-mode .setting-item { border-bottom-color: rgba(0,0,0,0.05); }
        body.light-mode .setting-info p { color: #666; }
        body.light-mode select, body.light-mode input[type="text"] {
            background: #fff;
            border-color: #ddd;
            color: #333;
        }
        body.light-mode .avatar-upload-container { background: rgba(0,0,0,0.02); }
        body.light-mode .btn-action {
            background: #fff;
            border-color: #ddd;
            color: #666;
        }
        body.light-mode .btn-action:hover {
            background: #f8f8f8;
            border-color: #4CAF50;
            color: #4CAF50;
        }

        .settings-container {
            max-width: 800px;
            margin: 100px auto 50px;
            padding: 30px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            backdrop-filter: blur(15px);
            border: 1px solid rgba(76, 175, 80, 0.2);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            animation: settingsEnter 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes settingsEnter {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .settings-container.page-exit {
            animation: pageExit 0.6s cubic-bezier(0.4, 0, 0.2, 1) forwards !important;
        }

        @keyframes pageExit {
            from { opacity: 1; transform: translateY(0); filter: blur(0); }
            to { opacity: 0; transform: translateY(-20px); filter: blur(5px); }
        }

        h1 {
            color: #4CAF50;
            border-bottom: 2px solid rgba(76, 175, 80, 0.3);
            padding-bottom: 15px;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .settings-section {
            margin-bottom: 40px;
            animation: sectionFade 0.5s ease-out backwards;
        }
        .settings-section:nth-child(2) { animation-delay: 0.1s; }
        .settings-section:nth-child(3) { animation-delay: 0.2s; }

        @keyframes sectionFade {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        h2 {
            font-size: 1.2em;
            color: #81C784;
            margin-bottom: 20px;
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .setting-info h3 {
            margin: 0;
            font-size: 16px;
            font-weight: 600;
        }
        .setting-info p {
            margin: 5px 0 0;
            font-size: 13px;
            color: #aaa;
        }

        /* å¼€å…³æ ·å¼ */
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: #333;
            transition: .4s;
            border-radius: 24px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 18px; width: 18px;
            left: 3px; bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider { background-color: #4CAF50; }
        input:checked + .slider:before { transform: translateX(26px); }

        /* ç§»åŠ¨ç«¯é€‚é… */
        @media (max-width: 768px) {
            .game-navbar {
                padding: 0 20px;
            }
            .menu-toggle {
                display: flex;
            }
            .nav-links {
                position: fixed;
                top: 70px;
                left: 0;
                right: 0;
                background: rgba(20, 20, 20, 0.98);
                flex-direction: column;
                gap: 0;
                padding: 20px 0;
                border-bottom: 2px solid #4CAF50;
                transform: translateY(-150%);
                transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                box-shadow: 0 10px 20px rgba(0,0,0,0.5);
            }
            .nav-links.active {
                transform: translateY(0);
            }
            .nav-link {
                padding: 15px 30px;
                display: block;
            }
            .nav-user {
                gap: 10px;
            }
            .exclusive-channel {
                display: none;
            }
            .settings-container {
                margin: 90px 15px 30px;
                padding: 20px;
            }
            h1 {
                font-size: 1.5em;
            }
            .setting-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            .setting-info {
                width: 100%;
            }
            select, input[type="text"], .btn-save {
                width: 100%;
                box-sizing: border-box;
            }
            .avatar-upload-container {
                flex-direction: column;
                text-align: center;
            }
        }

        /* ä¸‹æ‹‰é€‰æ‹©å’Œè¾“å…¥æ¡† */
        select, input[type="text"] {
            background: rgba(0,0,0,0.3);
            border: 1px solid #444;
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            outline: none;
        }
        select:focus { border-color: #4CAF50; }

        .btn-save {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 12px 40px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            display: block;
            margin: 40px auto 0;
            transition: 0.3s;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
        }
        .btn-save:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.5);
        }

        /* æˆåŠŸæç¤ºå¢å¼º */
        /* å®‰å…¨ç­‰çº§è¿›åº¦æ¡ */
        .security-level-container {
            margin-top: 10px;
            background: rgba(255, 255, 255, 0.1);
            height: 6px;
            border-radius: 3px;
            overflow: hidden;
            width: 100px;
        }
        .security-level-bar {
            height: 100%;
            background: linear-gradient(90deg, #ff4b2b, #ff416c);
            width: 35%;
            transition: width 1s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .security-level-bar.high {
            background: linear-gradient(90deg, #4CAF50, #81C784);
            width: 85%;
        }

        .btn-action {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #ddd;
            padding: 6px 15px;
            border-radius: 4px;
            font-size: 13px;
            cursor: pointer;
            transition: 0.3s;
        }
        .btn-action:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: #4CAF50;
            color: #fff;
        }

        #toast {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(20, 20, 20, 0.95);
            color: white;
            padding: 30px 50px;
            border-radius: 15px;
            display: none;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            z-index: 2000;
            border: 2px solid #4CAF50;
            box-shadow: 0 0 30px rgba(76, 175, 80, 0.4);
            backdrop-filter: blur(10px);
            text-align: center;
        }

        .loader {
            width: 40px;
            height: 40px;
            border: 4px solid #333;
            border-top: 4px solid #4CAF50;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .countdown-text {
            color: #4CAF50;
            font-weight: bold;
            font-size: 1.2em;
        }

        /* å¤´åƒä¸Šä¼ æ ·å¼ */
        .avatar-upload-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            margin-bottom: 25px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 15px;
        }
        .preview-avatar-large {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            border: 3px solid #4CAF50;
            object-fit: cover;
            box-shadow: 0 0 20px rgba(76, 175, 80, 0.3);
        }
        .upload-hint {
            font-size: 12px;
            color: #888;
        }
    </style>
</head>
<body>
    <nav class="game-navbar">
        <a href="index.html" class="nav-logo">ğŸ® GC</a>
        <div class="menu-toggle" onclick="toggleMenu()">
            <span></span>
            <span></span>
            <span></span>
        </div>
        <ul class="nav-links" id="navLinks">
            <li><a href="index.html" class="nav-link">ğŸ  é¦–é¡µ</a></li>
            <li><a href="game_list.html" class="nav-link">ğŸ® æ¸¸æˆå¤§å…¨</a></li>
            <li><a href="admin_dashboard.html" class="nav-link">ğŸ›¡ï¸ ç®¡ç†é¢æ¿</a></li>
            <li><a href="settings.html" class="nav-link active">âš™ï¸ è®¾ç½®</a></li>
        </ul>
        <div class="nav-user">
            <span class="exclusive-channel">ğŸ’ ä¸“å±é€šé“</span>
            <div class="user-avatar" onclick="location.hash='account-section'">
                <img src="./avatar.jpg" id="navAvatar" alt="Avatar" onerror="this.src='https://img.icons8.com/color/96/girl-profile.png'">
            </div>
        </div>
    </nav>

    <div class="settings-container">
        <h1>âš™ï¸ ç³»ç»Ÿè®¾ç½®</h1>

        <div class="settings-section">
            <h2>ğŸ–¥ï¸ æ˜¾ç¤ºè®¾ç½®</h2>
            <div class="setting-item">
                <div class="setting-info">
                    <h3>æ·±è‰²æ¨¡å¼</h3>
                    <p>åˆ‡æ¢ç³»ç»Ÿç•Œé¢çš„æ˜æš—ä¸»é¢˜</p>
                </div>
                <label class="switch">
                    <input type="checkbox" id="darkModeToggle" checked>
                    <span class="slider"></span>
                </label>
            </div>
            <div class="setting-item">
                <div class="setting-info">
                    <h3>èƒŒæ™¯è£…é¥°åŠ¨ç”»</h3>
                    <p>å¯ç”¨é¦–é¡µçš„æ¼‚æµ®å…ƒç´ æ•ˆæœ</p>
                </div>
                <label class="switch">
                    <input type="checkbox" id="bgAnimToggle" checked>
                    <span class="slider"></span>
                </label>
            </div>
            <div class="setting-item">
                <div class="setting-info">
                    <h3>ç•Œé¢è¯­è¨€</h3>
                    <p>æ›´æ”¹æ¸¸æˆå¹³å°çš„æ˜¾ç¤ºè¯­è¨€</p>
                </div>
                <select id="languageSelect">
                    <option value="zh">ç®€ä½“ä¸­æ–‡</option>
                    <option value="en">English</option>
                    <option value="jp">æ—¥æœ¬èª</option>
                </select>
            </div>
        </div>

        <div class="settings-section">
            <h2>ğŸ”” é€šçŸ¥ä¸éšç§</h2>
            <div class="setting-item">
                <div class="setting-info">
                    <h3>æŸ¥è¯¢ç»“æœæ¨é€</h3>
                    <p>ç”³è¯·è¿›åº¦æ›´æ–°æ—¶å‘é€é€šçŸ¥</p>
                </div>
                <label class="switch">
                    <input type="checkbox" id="pushNotifyToggle">
                    <span class="slider"></span>
                </label>
            </div>
        </div>

        <div class="settings-section" id="account-section">
            <h2 id="secSecurityTitle">ğŸ›¡ï¸ è´¦å·å®‰å…¨</h2>
            
            <div class="avatar-upload-container">
                <img src="./avatar.jpg" id="previewAvatar" class="preview-avatar-large" alt="Avatar Preview">
                <button class="btn-action" onclick="document.getElementById('avatarInput').click()">æ›´æ¢å¤´åƒ</button>
                <input type="file" id="avatarInput" hidden accept="image/*" onchange="previewFile()">
                <p class="upload-hint">æ”¯æŒ jpg, png æ ¼å¼ï¼Œå»ºè®®å°ºå¯¸ 200x200</p>
            </div>

            <div class="setting-item">
                <div class="setting-info">
                    <h3 id="itemUser">å½“å‰ç”¨æˆ·</h3>
                    <p id="itemUserDesc">ä¿®æ”¹æ‚¨çš„æ˜¾ç¤ºæ˜µç§°</p>
                </div>
                <input type="text" id="userNameInput" value="å°ç¾">
            </div>
            <div class="setting-item">
                <div class="setting-info">
                    <h3 id="itemSecurityLevel">è´¦å·å®‰å…¨ç­‰çº§</h3>
                    <p id="itemSecurityLevelDesc">å»ºè®®å¼€å¯åŒé‡éªŒè¯æé«˜å®‰å…¨æ€§</p>
                    <div class="security-level-container">
                        <div class="security-level-bar" id="securityBar"></div>
                    </div>
                </div>
                <span id="securityStatus" style="color: #ff4b2b; font-size: 13px; font-weight: bold;">ä¸­ç­‰</span>
            </div>
            <div class="setting-item">
                <div class="setting-info">
                    <h3 id="item2FA">ç™»å½•ä¿æŠ¤ (2FA)</h3>
                    <p id="item2FADesc">æ–°è®¾å¤‡ç™»å½•æ—¶éœ€è¦éªŒè¯ç </p>
                </div>
                <label class="switch">
                    <input type="checkbox" id="twoFAToggle">
                    <span class="slider"></span>
                </label>
            </div>
            <div class="setting-item">
                <div class="setting-info">
                    <h3 id="itemPassword">ç™»å½•å¯†ç </h3>
                    <p id="itemPasswordDesc">ä¸Šæ¬¡ä¿®æ”¹äº 3 ä¸ªæœˆå‰</p>
                </div>
                <button class="btn-action" onclick="showChangePwd()" id="btnChangePwd">ä¿®æ”¹å¯†ç </button>
            </div>
        </div>

        <!-- ä¿®æ”¹å¯†ç å¼¹çª— -->
        <div id="changePwdModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:2000; justify-content:center; align-items:center;">
            <div class="settings-container" style="width:350px; margin:0; border: 1px solid #4CAF50;">
                <h2 style="margin-top:0;" id="modalPwdTitle">ä¿®æ”¹å¯†é’¥</h2>
                <div class="setting-item" style="flex-direction:column; align-items:flex-start; border:none;">
                    <label style="font-size:13px; color:#aaa; margin-bottom:5px;" id="lblOldPwd">å½“å‰å¯†é’¥</label>
                    <input type="password" id="oldPwd" style="width:100%; box-sizing:border-box;" placeholder="è¯·è¾“å…¥æ—§å¯†ç ">
                </div>
                <div class="setting-item" style="flex-direction:column; align-items:flex-start; border:none;">
                    <label style="font-size:13px; color:#aaa; margin-bottom:5px;" id="lblNewPwd">æ–°å¯†é’¥</label>
                    <input type="password" id="newPwd" style="width:100%; box-sizing:border-box;" placeholder="è‡³å°‘ 6 ä½å­—ç¬¦">
                </div>
                <div class="setting-item" style="flex-direction:column; align-items:flex-start; border:none;">
                    <label style="font-size:13px; color:#aaa; margin-bottom:5px;" id="lblConfirmPwd">ç¡®è®¤æ–°å¯†é’¥</label>
                    <input type="password" id="confirmNewPwd" style="width:100%; box-sizing:border-box;" placeholder="è¯·å†æ¬¡è¾“å…¥æ–°å¯†ç ">
                </div>
                <div style="display:flex; gap:10px; margin-top:20px;">
                    <button class="btn-save" style="flex:1; margin:0;" onclick="handleChangePwd()" id="btnSavePwd">ä¿å­˜æ–°å¯†é’¥</button>
                    <button class="btn-save" style="flex:1; margin:0; background:#444;" onclick="hideChangePwd()" id="btnCancelPwd">å–æ¶ˆ</button>
                </div>
            </div>
        </div>

        <button class="btn-save" onclick="saveSettings()">ä¿å­˜æ›´æ”¹</button>
        <button class="btn-save" style="background: #333; margin-top: 15px;" onclick="handleLogout()" id="btnLogout">é€€å‡ºç™»å½•</button>
    </div>

    <div id="toast">
        <div class="loader"></div>
        <div style="font-size: 18px; font-weight: bold;">âœ… è®¾ç½®å·²ä¿å­˜ï¼</div>
        <div class="countdown-text">æ­£åœ¨å‰å¾€é¦–é¡µ... <span id="seconds">1.5</span>s</div>
    </div>

    <script>
        // ç§»åŠ¨ç«¯èœå•åˆ‡æ¢
        function toggleMenu() {
            const navLinks = document.getElementById('navLinks');
            navLinks.classList.toggle('active');
            
            const spans = document.querySelectorAll('.menu-toggle span');
            if (navLinks.classList.contains('active')) {
                spans[0].style.transform = 'rotate(45deg) translate(5px, 6px)';
                spans[1].style.opacity = '0';
                spans[2].style.transform = 'rotate(-45deg) translate(5px, -7px)';
            } else {
                spans[0].style.transform = 'none';
                spans[1].style.opacity = '1';
                spans[2].style.transform = 'none';
            }
        }

        // ç™»å½•çŠ¶æ€æ‹¦æˆª
        function checkAuth() {
            if (sessionStorage.getItem('isAdminLoggedIn') !== 'true') {
                window.location.href = 'admin_auth.html';
            }
        }
        checkAuth();

        const i18n = {
            zh: {
                navHome: "ğŸ  é¦–é¡µ",
                navGames: "ğŸ® æ¸¸æˆå¤§å…¨",
                navAdmin: "ğŸ›¡ï¸ ç®¡ç†é¢æ¿",
                navSettings: "âš™ï¸ è®¾ç½®",
                title: "âš™ï¸ ç³»ç»Ÿè®¾ç½®",
                sectionDisplay: "ğŸ–¥ï¸ æ˜¾ç¤ºè®¾ç½®",
                itemDark: "æ·±è‰²æ¨¡å¼",
                itemDarkDesc: "åˆ‡æ¢ç³»ç»Ÿç•Œé¢çš„æ˜æš—ä¸»é¢˜",
                itemAnim: "èƒŒæ™¯è£…é¥°åŠ¨ç”»",
                itemAnimDesc: "å¯ç”¨é¦–é¡µçš„æ¼‚æµ®å…ƒç´ æ•ˆæœ",
                itemLang: "ç•Œé¢è¯­è¨€",
                itemLangDesc: "æ›´æ”¹æ¸¸æˆå¹³å°çš„æ˜¾ç¤ºè¯­è¨€",
                sectionNotify: "ğŸ”” é€šçŸ¥ä¸éšç§",
                itemPush: "æŸ¥è¯¢ç»“æœæ¨é€",
                itemPushDesc: "ç”³è¯·è¿›åº¦æ›´æ–°æ—¶å‘é€é€šçŸ¥",
                sectionSecurity: "ğŸ›¡ï¸ è´¦å·å®‰å…¨",
                itemUser: "å½“å‰ç”¨æˆ·",
                itemUserDesc: "ä¿®æ”¹æ‚¨çš„æ˜¾ç¤ºæ˜µç§°",
                itemSecurityLevel: "è´¦å·å®‰å…¨ç­‰çº§",
                itemSecurityLevelDesc: "å»ºè®®å¼€å¯åŒé‡éªŒè¯æé«˜å®‰å…¨æ€§",
                item2FA: "ç™»å½•ä¿æŠ¤ (2FA)",
                item2FADesc: "æ–°è®¾å¤‡ç™»å½•æ—¶éœ€è¦éªŒè¯ç ",
                itemPassword: "ç™»å½•å¯†ç ",
                itemPasswordDesc: "ä¸Šæ¬¡ä¿®æ”¹äº 3 ä¸ªæœˆå‰",
                btnChangePwd: "ä¿®æ”¹å¯†ç ",
                statusMedium: "ä¸­ç­‰",
                statusHigh: "å®‰å…¨",
                btnSave: "ä¿å­˜æ›´æ”¹",
                btnLogout: "é€€å‡ºç™»å½•",
                toast: "âœ… è®¾ç½®å·²ä¿å­˜ï¼",
                countdown: "æ­£åœ¨å‰å¾€é¦–é¡µ...",
                sectionAdmin: "ğŸ›¡ï¸ ç®¡ç†å‘˜é¢æ¿",
                itemAdminStats: "æ•°æ®ç»Ÿè®¡",
                itemAdminStatsDesc: "æŸ¥çœ‹å…¨ç«™ç”³è¯·æ•°æ®æ¦‚å†µ",
                itemAdminClear: "å…¨å±€æ¸…ç†",
                itemAdminClearDesc: "æ¸…ç©ºæ‰€æœ‰ç”¨æˆ·çš„å†å²è®°å½•",
                btnAdminView: "æŸ¥çœ‹æ•°æ®",
                btnAdminClear: "ç«‹å³æ¸…ç†",
                modalPwdTitle: "ä¿®æ”¹å¯†é’¥",
                lblOldPwd: "å½“å‰å¯†é’¥",
                lblNewPwd: "æ–°å¯†é’¥",
                lblConfirmPwd: "ç¡®è®¤æ–°å¯†é’¥",
                btnSavePwd: "ä¿å­˜æ–°å¯†é’¥",
                btnCancelPwd: "å–æ¶ˆ",
                pwdErrorOld: "å½“å‰å¯†é’¥é”™è¯¯ï¼",
                pwdErrorMatch: "ä¸¤æ¬¡è¾“å…¥çš„æ–°å¯†é’¥ä¸ä¸€è‡´ï¼",
                pwdErrorShort: "æ–°å¯†é’¥è‡³å°‘éœ€è¦ 6 ä½ï¼",
                pwdSuccess: "å¯†é’¥ä¿®æ”¹æˆåŠŸï¼è¯·é‡æ–°ç™»å½•",
                pwdFillAll: "è¯·å¡«å†™æ‰€æœ‰å­—æ®µ"
            },
            en: {
                navHome: "ğŸ  Home",
                navGames: "ğŸ® Games",
                navAdmin: "ğŸ›¡ï¸ Admin",
                navSettings: "âš™ï¸ Settings",
                title: "âš™ï¸ Settings",
                sectionDisplay: "ğŸ–¥ï¸ Display",
                itemDark: "Dark Mode",
                itemDarkDesc: "Toggle light/dark theme",
                itemAnim: "Background Animation",
                itemAnimDesc: "Enable floating elements on home",
                itemLang: "Language",
                itemLangDesc: "Change platform language",
                sectionNotify: "ğŸ”” Notifications",
                itemPush: "Push Results",
                itemPushDesc: "Notify on progress updates",
                sectionSecurity: "ğŸ›¡ï¸ Security",
                itemUser: "Username",
                itemUserDesc: "Change your display name",
                itemSecurityLevel: "Security Level",
                itemSecurityLevelDesc: "2FA is recommended for better security",
                item2FA: "Two-Factor Auth (2FA)",
                item2FADesc: "Verification code for new devices",
                itemPassword: "Login Password",
                itemPasswordDesc: "Last changed 3 months ago",
                btnChangePwd: "Change",
                statusMedium: "Medium",
                statusHigh: "Secure",
                btnSave: "Save Changes",
                btnLogout: "Logout",
                toast: "âœ… Settings Saved!",
                countdown: "Redirecting to home...",
                sectionAdmin: "ğŸ›¡ï¸ Admin Panel",
                itemAdminStats: "Statistics",
                itemAdminStatsDesc: "View overall application data",
                itemAdminClear: "Global Clear",
                itemAdminClearDesc: "Clear history for all users",
                btnAdminView: "View",
                btnAdminClear: "Clear All",
                modalPwdTitle: "Change Password",
                lblOldPwd: "Old Password",
                lblNewPwd: "New Password",
                lblConfirmPwd: "Confirm New Password",
                btnSavePwd: "Save Password",
                btnCancelPwd: "Cancel",
                pwdErrorOld: "Incorrect old password!",
                pwdErrorMatch: "Passwords do not match!",
                pwdErrorShort: "Password must be at least 6 characters!",
                pwdSuccess: "Password updated! Please login again",
                pwdFillAll: "Please fill all fields"
            },
            jp: {
                navHome: "ğŸ  ãƒ›ãƒ¼ãƒ ",
                navGames: "ğŸ® ã‚²ãƒ¼ãƒ ä¸€è¦§",
                navAdmin: "ğŸ›¡ï¸ ç®¡ç†ãƒ‘ãƒãƒ«",
                navSettings: "âš™ï¸ è¨­å®š",
                title: "âš™ï¸ ã‚·ã‚¹ãƒ†ãƒ è¨­å®š",
                sectionDisplay: "ğŸ–¥ï¸ è¡¨ç¤ºè¨­å®š",
                itemDark: "ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰",
                itemDarkDesc: "ãƒ©ã‚¤ãƒˆ/ãƒ€ãƒ¼ã‚¯ãƒ†ãƒ¼ãƒã®åˆ‡ã‚Šæ›¿ãˆ",
                itemAnim: "èƒŒæ™¯ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³",
                itemAnimDesc: "ãƒ›ãƒ¼ãƒ ã®æµ®éŠè¦ç´ ã‚’æœ‰åŠ¹ã«ã™ã‚‹",
                itemLang: "è¡¨ç¤ºè¨€èª",
                itemLangDesc: "ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã®è¨€èªã‚’å¤‰æ›´",
                sectionNotify: "ğŸ”” é€šçŸ¥ã¨ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼",
                itemPush: "ç»“æœãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥",
                itemPushDesc: "é€²æ—æ›´æ–°æ™‚ã«é€šçŸ¥ã‚’å—ã‘å–ã‚‹",
                sectionSecurity: "ğŸ›¡ï¸ ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£",
                itemUser: "ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼",
                itemUserDesc: "è¡¨ç¤ºåã‚’å¤‰æ›´ã™ã‚‹",
                itemSecurityLevel: "ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¬ãƒ™ãƒ«",
                itemSecurityLevelDesc: "äºŒæ®µéšèªè¨¼ã‚’æœ‰åŠ¹ã«ã™ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™",
                item2FA: "ãƒ­ã‚°ã‚¤ãƒ³ä¿è­· (2FA)",
                item2FADesc: "æ–°ã—ã„ãƒ‡ãƒã‚¤ã‚¹ã§ã®ãƒ­ã‚°ã‚¤ãƒ³ã«èªè¨¼ã‚³ãƒ¼ãƒ‰ãŒå¿…è¦",
                itemPassword: "ãƒ­ã‚°ã‚¤ãƒ³ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰",
                itemPasswordDesc: "3ãƒ¶æœˆå‰ã«å¤‰æ›´ã•ã‚Œã¾ã—ãŸ",
                btnChangePwd: "å¤‰æ›´ã™ã‚‹",
                statusMedium: "æ™®é€š",
                statusHigh: "å®‰å…¨",
                btnSave: "å¤‰æ›´ã‚’ä¿å­˜",
                btnLogout: "ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ",
                toast: "âœ… è¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸï¼",
                countdown: "ãƒ›ãƒ¼ãƒ ã¸ç§»å‹•ä¸­...",
                sectionAdmin: "ğŸ›¡ï¸ ç®¡ç†è€…ãƒ‘ãƒãƒ«",
                itemAdminStats: "çµ±è¨ˆãƒ‡ãƒ¼ã‚¿",
                itemAdminStatsDesc: "ã‚µã‚¤ãƒˆå…¨ä½“ã®ç”³è«‹çŠ¶æ³ã‚’ç¢ºèª",
                itemAdminClear: "å…¨å‰Šé™¤",
                itemAdminClearDesc: "å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å±¥æ­´ã‚’å‰Šé™¤",
                btnAdminView: "è¡¨ç¤º",
                btnAdminClear: "å‰Šé™¤å®Ÿè¡Œ",
                modalPwdTitle: "ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´",
                lblOldPwd: "ç¾åœ¨ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰",
                lblNewPwd: "æ–°ã—ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰",
                lblConfirmPwd: "ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®ç¢ºèª",
                btnSavePwd: "ä¿å­˜ã™ã‚‹",
                btnCancelPwd: "ã‚­ãƒ£ãƒ³ã‚»ãƒ«",
                pwdErrorOld: "ç¾åœ¨ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“",
                pwdErrorMatch: "æ–°ã—ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒä¸€è‡´ã—ã¾ã›ã‚“",
                pwdErrorShort: "ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯6æ–‡å­—ä»¥ä¸Šå¿…è¦ã§ã™",
                pwdSuccess: "å¤‰æ›´ã—ã¾ã—ãŸï¼å†åº¦ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„",
                pwdFillAll: "ã™ã¹ã¦ã®é …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"
            }
        };

        // é»˜è®¤è®¾ç½®
        const defaultSettings = {
            darkMode: true,
            bgAnim: true,
            userName: 'å°ç¾',
            language: 'zh',
            pushNotify: true,
            hideHistory: false,
            twoFA: false
        };

        // åˆå§‹åŒ–åŠ è½½è®¾ç½®
        function initSettings() {
            try {
                const savedRaw = localStorage.getItem('gameCenterSettings');
                const saved = savedRaw ? JSON.parse(savedRaw) : defaultSettings;
                
                // ç¡®ä¿ DOM çŠ¶æ€ä¸æ•°æ®åŒæ­¥
                const elements = {
                    'darkModeToggle': { prop: 'checked', value: saved.darkMode !== false },
                    'bgAnimToggle': { prop: 'checked', value: saved.bgAnim !== false },
                    'userNameInput': { prop: 'value', value: saved.userName || defaultSettings.userName },
                    'languageSelect': { prop: 'value', value: saved.language || defaultSettings.language },
                    'pushNotifyToggle': { prop: 'checked', value: saved.pushNotify !== false },
                    'twoFAToggle': { prop: 'checked', value: saved.twoFA === true }
                };

                for (const [id, config] of Object.entries(elements)) {
                    const el = document.getElementById(id);
                    if (el) el[config.prop] = config.value;
                }
                
                if (saved.avatar) {
                    const preview = document.getElementById('previewAvatar');
                    const nav = document.getElementById('navAvatar');
                    if (preview) preview.src = saved.avatar;
                    if (nav) nav.src = saved.avatar;
                }
                
                applySettings(saved);
            } catch (err) {
                console.error('Settings init error:', err);
                applySettings(defaultSettings);
            }
        }

        function applySettings(saved) {
            try {
                const lang = saved.language || 'zh';
                const dict = i18n[lang] || i18n['zh'];

                // å®‰å…¨æ›´æ–°æ–‡æœ¬é€»è¾‘ï¼Œé˜²æ­¢å› å…ƒç´ ç¼ºå¤±å¯¼è‡´å´©æºƒ
                const safeSetText = (id, text) => {
                    const el = document.getElementById(id);
                    if (el) el.textContent = text;
                };

                // åº”ç”¨ä¸»é¢˜ - ä¿æŒä¸ index.html é€»è¾‘ä¸€è‡´
                const isDark = saved.darkMode !== false;
                if (isDark) {
                    document.body.classList.remove('light-mode');
                } else {
                    document.body.classList.add('light-mode');
                }

                // æ›´æ–°å¯¼èˆªå¤´åƒå’Œåç§°
                const navAvatar = document.getElementById('navAvatar');
                if (navAvatar && saved.avatar) navAvatar.src = saved.avatar;
                
                const previewAvatar = document.getElementById('previewAvatar');
                if (previewAvatar && saved.avatar) previewAvatar.src = saved.avatar;

                if (saved.userName) {
                    const channel = document.querySelector('.exclusive-channel');
                    if (channel) {
                        const suffix = lang === 'zh' ? 'ä¸“å±' : (lang === 'jp' ? 'å°‚ç”¨' : 'Exclusive');
                        channel.textContent = `ğŸ’ ${saved.userName} ${suffix}`;
                    }
                }

                const navLinks = document.querySelectorAll('.nav-link');
                const navTexts = [dict.navHome, dict.navGames, dict.navAdmin, dict.navSettings];
                navLinks.forEach((link, i) => {
                    if (link && navTexts[i]) link.textContent = navTexts[i];
                });

                const h1 = document.querySelector('h1');
                if (h1) h1.textContent = dict.title;

                const sections = document.querySelectorAll('h2');
                if (sections[0]) sections[0].textContent = dict.sectionDisplay;
                if (sections[1]) sections[1].textContent = dict.sectionNotify;
                
                safeSetText('secSecurityTitle', dict.sectionSecurity);
                safeSetText('itemUser', dict.itemUser);
                safeSetText('itemUserDesc', dict.itemUserDesc);
                safeSetText('itemSecurityLevel', dict.itemSecurityLevel);
                safeSetText('itemSecurityLevelDesc', dict.itemSecurityLevelDesc);
                safeSetText('item2FA', dict.item2FA);
                safeSetText('item2FADesc', dict.item2FADesc);
                safeSetText('itemPassword', dict.itemPassword);
                safeSetText('itemPasswordDesc', dict.itemPasswordDesc);
                safeSetText('btnChangePwd', dict.btnChangePwd);

                // åŠ¨æ€å®‰å…¨ç­‰çº§
                const bar = document.getElementById('securityBar');
                const status = document.getElementById('securityStatus');
                if (bar && status) {
                    if (saved.twoFA) {
                        bar.classList.add('high');
                        status.textContent = dict.statusHigh;
                        status.style.color = '#4CAF50';
                    } else {
                        bar.classList.remove('high');
                        status.textContent = dict.statusMedium;
                        status.style.color = '#ff4b2b';
                    }
                }

                // ç¿»è¯‘è¡¨å•é¡¹
                const itemTitles = document.querySelectorAll('.setting-info h3');
                const itemDescs = document.querySelectorAll('.setting-info p');
                const fieldTexts = [
                    [dict.itemDark, dict.itemDarkDesc],
                    [dict.itemAnim, dict.itemAnimDesc],
                    [dict.itemLang, dict.itemLangDesc],
                    [dict.itemPush, dict.itemPushDesc]
                ];
                
                fieldTexts.forEach((texts, i) => {
                    if (itemTitles[i]) itemTitles[i].textContent = texts[0];
                    if (itemDescs[i]) itemDescs[i].textContent = texts[1];
                });

                // ç¿»è¯‘æŒ‰é’®
                const saveBtn = document.querySelector('button[onclick="saveSettings()"]');
                if (saveBtn) saveBtn.textContent = dict.btnSave;
                
                const logoutBtn = document.getElementById('btnLogout');
                if (logoutBtn) logoutBtn.textContent = dict.btnLogout;
                
                // ç¿»è¯‘ Toast
                const toast = document.getElementById('toast');
                if (toast) {
                    const toastTitle = toast.querySelector('div:nth-child(2)');
                    if (toastTitle) toastTitle.textContent = dict.toast;
                    const toastCountdown = toast.querySelector('.countdown-text');
                    if (toastCountdown && toastCountdown.childNodes[0]) {
                        toastCountdown.childNodes[0].textContent = dict.countdown;
                    }
                }

                // ç¿»è¯‘ä¿®æ”¹å¯†ç å¼¹çª—
                if (document.getElementById('modalPwdTitle')) {
                    safeSetText('modalPwdTitle', dict.modalPwdTitle);
                    safeSetText('lblOldPwd', dict.lblOldPwd);
                    safeSetText('lblNewPwd', dict.lblNewPwd);
                    safeSetText('lblConfirmPwd', dict.lblConfirmPwd);
                    safeSetText('btnSavePwd', dict.btnSavePwd);
                    safeSetText('btnCancelPwd', dict.btnCancelPwd);
                    
                    const oldPwd = document.getElementById('oldPwd');
                    const newPwd = document.getElementById('newPwd');
                    const confirmNewPwd = document.getElementById('confirmNewPwd');
                    
                    if (oldPwd) oldPwd.placeholder = lang === 'zh' ? 'è¯·è¾“å…¥æ—§å¯†ç ' : (lang === 'jp' ? 'ç¾åœ¨ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰' : 'Enter old password');
                    if (newPwd) newPwd.placeholder = lang === 'zh' ? 'è‡³å°‘ 6 ä½å­—ç¬¦' : (lang === 'jp' ? '6æ–‡å­—ä»¥ä¸Š' : 'Min 6 characters');
                    if (confirmNewPwd) confirmNewPwd.placeholder = lang === 'zh' ? 'è¯·å†æ¬¡è¾“å…¥æ–°å¯†ç ' : (lang === 'jp' ? 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å†å…¥åŠ›' : 'Confirm new password');
                }
            } catch (err) {
                console.error('applySettings execution error:', err);
            }
        }

        // é¡µé¢ä¸æ»‘è·³è½¬é€»è¾‘
        document.querySelectorAll('a').forEach(link => {
            link.addEventListener('click', function(e) {
                const href = this.getAttribute('href');
                if (href && href !== '#' && !href.startsWith('http') && !href.includes('javascript:void(0)')) {
                    e.preventDefault();
                    const container = document.querySelector('.settings-container');
                    if (container) {
                        container.classList.add('page-exit');
                        setTimeout(() => {
                            window.location.href = href;
                        }, 500);
                    } else {
                        window.location.href = href;
                    }
                }
            });
        });

        function handleLogout() {
            sessionStorage.removeItem('isAdminLoggedIn');
            sessionStorage.removeItem('currentAdmin');
            window.location.href = 'admin_auth.html';
        }

        function showChangePwd() {
            document.getElementById('changePwdModal').style.display = 'flex';
        }

        function hideChangePwd() {
            document.getElementById('changePwdModal').style.display = 'none';
        }

        function handleChangePwd() {
            const oldPwd = document.getElementById('oldPwd').value;
            const newPwd = document.getElementById('newPwd').value;
            const confirmNewPwd = document.getElementById('confirmNewPwd').value;
            
            const lang = localStorage.getItem('gameCenterSettings') ? JSON.parse(localStorage.getItem('gameCenterSettings')).language : 'zh';
            const dict = i18n[lang || 'zh'];

            if (!oldPwd || !newPwd || !confirmNewPwd) {
                alert(dict.pwdFillAll);
                return;
            }

            if (newPwd.length < 6) {
                alert(dict.pwdErrorShort);
                return;
            }

            if (newPwd !== confirmNewPwd) {
                alert(dict.pwdErrorMatch);
                return;
            }

            const currentUser = sessionStorage.getItem('currentAdmin');
            const admins = JSON.parse(localStorage.getItem('gameAdmins')) || {};

            if (admins[currentUser] !== oldPwd) {
                alert(dict.pwdErrorOld);
                return;
            }

            // æ›´æ–°å¯†ç 
            admins[currentUser] = newPwd;
            localStorage.setItem('gameAdmins', JSON.stringify(admins));
            
            alert(dict.pwdSuccess);
            handleLogout();
        }

        function handleGlobalClear() {
            if (confirm('è­¦å‘Šï¼šæ­¤æ“ä½œå°†æ¸…ç©ºå…¨ç«™æ‰€æœ‰ç”¨æˆ·çš„å†å²è®°å½•ï¼Œæ˜¯å¦ç»§ç»­ï¼Ÿ')) {
                localStorage.removeItem('userSubmissionHistory');
                alert('æ¸…ç†æˆåŠŸ');
            }
        }

        function previewFile() {
            const preview = document.getElementById('previewAvatar');
            const file = document.getElementById('avatarInput').files[0];
            const reader = new FileReader();

            reader.onloadend = function () {
                preview.src = reader.result;
            }

            if (file) {
                reader.readAsDataURL(file);
            }
        }

        function saveSettings() {
            const settings = {
                darkMode: document.getElementById('darkModeToggle').checked,
                bgAnim: document.getElementById('bgAnimToggle').checked,
                userName: document.getElementById('userNameInput').value,
                language: document.getElementById('languageSelect').value,
                pushNotify: document.getElementById('pushNotifyToggle').checked,
                twoFA: document.getElementById('twoFAToggle').checked,
                avatar: document.getElementById('previewAvatar').src
            };

            localStorage.setItem('gameCenterSettings', JSON.stringify(settings));

            const toast = document.getElementById('toast');
            const secondsSpan = document.getElementById('seconds');
            let timeLeft = 1.5;

            toast.style.display = 'flex';
            
            const timer = setInterval(() => {
                timeLeft -= 0.5;
                secondsSpan.textContent = timeLeft.toFixed(1);
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    const container = document.querySelector('.settings-container');
                    container.classList.add('page-exit');
                    setTimeout(() => {
                        window.location.href = 'index.html';
                    }, 500);
                }
            }, 500);
        }

        // åˆå§‹åŒ–
        initSettings();
    </script>
</body>
</html>